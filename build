#!/bin/bash

# 1. defining variables
cd ../..
root=$PWD
content=$root/mp3unicode/trunk
web=$root/mp3unicode-web2/trunk
htdocs=`echo $1 | sed 's_/$__'`

if [ ! -z $htdocs ]; then

# 2. man2xhtml

man2html $content/mp3unicode.1 | tail -n +3 | sed "s/&nbsp;//g" | xmllint --dropdtd --html --xmlout --output $content/manpage.xhtml -

# 3. generating xml pages
cd $web/templates/pages
for xslpage in *.xsl
do
  htmlpage=`echo $xslpage | sed s/xsl$/html/`
  xsltproc --xinclude -o $htdocs/$htmlpage $xslpage $content/project.xml
done
echo "Html pages saved to $htdocs"

# 4. cleaning up
rm $content/manpage.xhtml

else
echo "Specify the path to htdocs."
fi